<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Boarding Poem</title>
  <style type="text/css">
    @font-face {
      font-family: MisekiBitmap;
      src: url("MisekiBitmap.ttf");
    }

    body {
      background-color: #f1f1f1;
      font-family: sans-serif;
      text-transform: uppercase;

      display: flex;
      flex-direction: column;
      align-items: center;
    }

    table {
      font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande",
        "Lucida Sans", Arial, sans-serif;
      background-color: white;
      border: solid 1px rgba(0, 0, 0, 0.2);
      border-radius: 2rem;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
      margin: 2rem;
      padding: 1rem;
      white-space: nowrap;
    }

    td {
      padding: 0.5rem 1rem 0.5rem 1rem;
    }

    small,
    ul {
      color: grey;
    }

    ul {
      font-size: calc(6px + 0.5rem);
      list-style-type: "* ";
      padding-left: 1rem;
      text-transform: none;
    }

    textarea {
      font-size: 16px;
      overflow: hidden;
      resize: none;
      text-align: center;
    }

    textarea,
    button,
    ul {
      margin: 0.5rem;
    }

    strong,
    .black,
    .margin,
    .poem {
      color: black;
    }

    .divider {
      border-right: 1px solid rgba(0, 0, 0, 0.2);
    }

    .margin {
      margin-left: 1rem;
    }

    .poem {
      font-family: "MisekiBitmap";
      letter-spacing: -0.125rem;
      line-height: 0.875rem;
      padding: 0;
    }

    .upper {
      position: relative;
      top: -0.125rem;
    }

    @media screen and (max-width: 700px) {
      html {
        font-size: 8px;
      }
    }
  </style>
</head>

<body>
  <table id="pass">
    <tr>
      <th colspan="5" rowspan="2">
        <span id="input-airline" class="input" contenteditable="true">Nice Boat Airlines</span>
      </th>
      <th class="divider" rowspan="6"></th>
      <th rowspan="6"></th>
      <th colspan="2">
        <span id="output-airline">Nice Boat Airlines</span>
      </th>
    </tr>
    <tr>
      <td>
        <small>Class</small>
        <br />
        <strong id="output-class">A</strong>
      </td>
      <td>
        <small>Seat</small>
        <br />
        <strong id="output-seat">01A</strong>
      </td>
    </tr>
    <tr>
      <td colspan="5">
        <small>Name</small>
        <br />
        <strong id="input-name" class="input" contenteditable="true">Kusa Zhang</strong>
      </td>
      <td colspan="2">
        <strong id="output-name">Kusa Zhang</strong>
        <br />
        <strong id="output-flight">E14514</strong>
      </td>
    </tr>
    <tr>
      <td>
        <small>Flight</small>
        <br />
        <strong id="input-flight" class="input" contenteditable="true">E14514</strong>
      </td>
      <td>
        <small>Date</small>
        <br />
        <strong id="input-date" class="input" contenteditable="true">9 Mar</strong>
      </td>
      <td>
        <small>At</small>
        <br />
        <strong id="input-at" class="input" contenteditable="true">13:15</strong>
      </td>
      <td>
        <small>Class</small>
        <br />
        <strong id="input-class" class="input" contenteditable="true">A</strong>
      </td>
      <td>
        <small>Seat</small>
        <br />
        <strong id="input-seat" class="input" contenteditable="true">01A</strong>
      </td>
      <td>
        <small>
          From
          <br />
          To
        </small>
      </td>
      <td>
        <small class="black">
          <span id="output-from">Baidi</span>
          <br />
          <span id="output-to">Jiangling</span>
        </small>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <small>From</small>
        <br />
        <strong id="input-from" class="input" contenteditable="true">Baidi</strong>
        <br />
        <small class="margin" contenteditable="true">BDI</small>
      </td>
      <td colspan="3">
        <small>To</small>
        <br />
        <strong id="input-to" class="input" contenteditable="true">Jiangling</strong>
        <br />
        <small class="margin" contenteditable="true">JLN</small>
      </td>
      <td><strong id="output-date">9 Mar</strong></td>
      <td><strong id="output-at">13:15</strong></td>
    </tr>
    <tr>
      <td>
        <small>Sequence</small>
        <br />
        <strong id="input-sequence" class="input" contenteditable="true">0005</strong>
      </td>
      <td colspan="2">
        <small>Boarding Time</small>
        <br />
        <strong id="output-boarding">12:45</strong>
      </td>
      <td class="poem" colspan="2">
        <span id="poem">
          ■Ⅲ 朝辭白帝彩雲間■|Ⅱ▏
          <br />
          ■Ⅲ 千里江陵一日還■|Ⅱ▏
          <br />
          ■Ⅲ 兩岸猿聲啼不住■|Ⅱ▏
          <br />
          ■Ⅲ 輕舟已過萬重山■|Ⅱ</span><span class="upper">▏</span>
      </td>
      <td><small>Sequence</small></td>
      <td><small id="output-sequence" class="black output">0005</small></td>
    </tr>
  </table>
  <textarea id="aera" rows="4">
朝辭白帝彩雲間
千里江陵一日還
兩岸猿聲啼不住
輕舟已過萬重山</textarea>
  <button id="save">Save as Image</button>
  <ul>
    <li>
      Fields are editable by clicking on them.<br />
      Customize your PoemCode™ from the text area.<br />
      Disable browser extensions if the image layout is incorrect.<br />
      <a href="https://github.com/ItMarki/MisekiBitmap">MisekiBitmap</a> font by Mark Li.
    </li>
  </ul>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    var aera = document.getElementById("aera");
    var poem = document.getElementById("poem");
    aera.addEventListener("input", function () {
      var lines = this.value.split("\n");
      if (lines.length >= 4) {
        this.value = lines.slice(0, 4).join("\n");
      }
      poem.innerHTML =
        `■Ⅲ ${this.value.replace(/ /g, "　").split("\n").join("■|Ⅱ▏<br />■Ⅲ ")}■|Ⅱ`
    });

    var save = document.getElementById("save");
    save.addEventListener("click", function () {
      html2canvas(document.getElementById("pass"), {
        scale: 4,
      }).then(function (canvas) {
        var img = canvas.toDataURL("image/png");
        var link = document.createElement("a");
        link.href = img;
        link.download = "boarding-poem.png";
        link.click();
      });
    });

    var inputs = document.querySelectorAll('.input');
    inputs.forEach(function (input) {
      input.addEventListener('input', function () {
        var id = "output-" + input.id.split("-")[1];
        document.getElementById(id).textContent = input.textContent;
        if (input.id === "input-at" && input.textContent.includes(":")) {
          var time = new Date();
          var parts = input.textContent.split(":");

          time.setHours(parseInt(parts[0]));
          time.setMinutes(parseInt(parts[1]));
          time = new Date(time.getTime() - 30 * 60000);

          const hours = time.getHours();
          const minutes = time.getMinutes();
          document.getElementById("output-boarding").textContent =
            `${hours < 10 ? "0" : ""}${hours}:${minutes < 10 ? "0" : ""}${minutes}`;
        };
      });
    });
  </script>
</body>

</html>